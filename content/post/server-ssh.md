+++
title = '自宅サーバーをsshでリモートアクセスできるようにした話'
date = 2023-10-26T12:56:24+09:00
draft = false
categories = ["", ""]
description = ""
image = ""
tags = ["サーバー", "ssh"]
author = "kurukurupotato"
+++

<!--more-->


## 事の発端
以前から、GUIのubuntuを導入しているpcをサーバーがわりに使用していたのですが、何気なくCUIのubuntu-serverを構築したいと思い立ったのが始まりでした。

## server環境の構築
serverの構築自体はすんなりと進みました。
ubuntu-serverのISOファイルを入れたUSBメモリからブートに成功。
その後、画面に従ってぽちぽちしているだけでOSのインストールが完了しました。（この時点ではネットワーク設定は触れていません！）

## IPアドレスの固定等のネットワーク設定
ubuntuは`etc/netplan`内にある`yamlファイル`を編集してネットワーク設定を行います。
```
network:
  version: 2
  ethernets:
    イーサネットインターフェース名:
      dhcp4: false
      dhcp6: false
      addresses: [固定するIPアドレス]
      gateway4: デフォルトゲートウェイのアドレス
      nameservers:
        addresses: [DNSアドレス]
```
今回はIPアドレスを固定するため、`dhcp4`と`dhcp6`はfalseに、残りのアドレスは適宜設定していきます。
この時、`yamlファイル`の書き込み権限を付与するのを忘れて2~3回vimで入力し直しました。（あほ）

## sshの設定
IPアドレスの固定ができたので、次はsshの設定をしていきます。
OSインストールの際にsshはインストール済みなので、早速鍵を作っていきます。
```
$ ssh-keygen -t rsa
```
上記コマンド実行後、`~/.ssh`上に秘密鍵の`id_rsa`と公開鍵の`id_rsa.pub`が作成されます。
その後、秘密鍵の方を接続元のMacBook Airに、USBメモリを用いて転送。適当な場所に秘密鍵を格納し、sshのconfigを編集してサーバーにsshできるよう設定しました。この時、接続元にある秘密鍵のパーミッションが適切でなかったため、サーバーに接続するためにパスワードを求められてしまいました。
```
$ sudo chmod 600 ~/.ssh/秘密鍵の名前(今回の場合id_rsa)
```
上記のコマンドでパーミッションを適切に設定し、サーバーにssh接続することに成功しました。

## 今後の展望
今回はsshのconfigにプライベートIPアドレスを設定しssh接続を行なったため、自宅LAN内でしかsshできない状態になっています。今後は外出先で自宅サーバーにsshできるようにしたいので、グローバルIPアドレスやポートフォワーディングなどの知識を深めて再挑戦したいと思います。☺️